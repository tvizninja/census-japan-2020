#!/bin/bash

outf="m5pop-2020.csv"
rm ./*.zip
rm ./*.txt
awk 'BEGIN{f=0}f{print $0}/^##/{f=1}' $0 | while read u; do a="${u#*code=}"; b="${a%&*}"; curl -s "$u" > "$b.zip"; sleep 5; done
find . -name "*.zip" -exec unzip -j {} \;
rm ./*.zip
find . -name "tbl*.txt" | while read f; do iconv -f cp932 -t UTF-8 "${f}" -o "${f/tbl/utbl}"; done
echo "KEY_CODE,HTKSYORI,HTKSAKI,GASSAN,T001102001,T001102002,T001102003,T001102004,T001102005,T001102006,T001102007,T001102008,T001102009,T001102010,T001102011,T001102012,T001102013,T001102014,T001102015,T001102016,T001102017,T001102018,T001102019,T001102020,T001102021,T001102022,T001102023,T001102024,T001102025,T001102026,T001102027,T001102028,T001102029,T001102030,T001102031,T001102032,T001102033,T001102034,T001102035,T001102036,T001102037,T001102038,T001102039,T001102040,T001102041,T001102042,T001102043,T001102044,T001102045,T001102046,T001102047,T001102048,T001102049,T001102050" > "$outf"
# "m5,HTKSYORI,HTKSAKI,GASSAN,total,totalm,totalf,a0_14,a0_14m,a0_14f,a15_,a15_m,a15_f,a15_64,a15_64m,a15_64f,a18_,a18_m,a18_f,a20_,a20_m,a20_f,a65_,a65_m,a65_f,a75_,a75_m,a75_f,a85_,a85_m,a85_f,a95_,a95_m,a95_f,fore,forem,foref,houset,house,houes1,house2,house3,house4,house5,house6,house7_,houserel,housecore,houesnotcore,housea_6,housea65_,house1_20_29,househis,househic"
# ",,,,　人口（総数）,　人口（総数）　男,　人口（総数）　女,　０～１４歳人口　総数,　０～１４歳人口　男,　０～１４歳人口　女,　１５歳以上人口　総数,　１５歳以上人口　男,　１５歳以上人口　女,　１５～６４歳人口　総数,　１５～６４歳人口　男,　１５～６４歳人口　女,　１８歳以上人口　総数,　１８歳以上人口　男,　１８歳以上人口　女,　２０歳以上人口　総数,　２０歳以上人口　男,　２０歳以上人口　女,　６５歳以上人口　総数,　６５歳以上人口　男,　６５歳以上人口　女,　７５歳以上人口　総数,　７５歳以上人口　男,　７５歳以上人口　女,　８５歳以上人口　総数,　８５歳以上人口　男,　８５歳以上人口　女,　９５歳以上人口　総数,　９５歳以上人口　男,　９５歳以上人口　女,　外国人人口　総数,　外国人人口　男,　外国人人口　女,　世帯総数,　一般世帯数,　１人世帯数　一般世帯数,　２人世帯数　一般世帯数,　３人世帯数　一般世帯数,　４人世帯数　一般世帯数,　５人世帯数　一般世帯数,　６人世帯数　一般世帯数,　７人以上世帯数　一般世帯数,　親族のみの世帯数　一般世帯数,　核家族世帯数　一般世帯数,　核家族以外の世帯数　一般世帯数,　６歳未満世帯員のいる世帯数　一般世帯数,　６５歳以上世帯員のいる世帯数　一般世帯数,　世帯主の年齢が２０～２９歳の１人世帯数　一般世帯数,　高齢単身世帯数　一般世帯数,　高齢夫婦世帯数　一般世帯数"
grep -h "^[0-9]" u*.txt | sed "s/\r//g" >> "$outf"
rm ./*.txt
gzip "$outf"

exit

## download file list
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3622&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3623&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3624&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3653&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3724&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3725&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3741&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3831&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3926&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3927&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3928&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=3942&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4027&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4028&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4042&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4128&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4129&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4229&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4230&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4329&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4429&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4530&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4531&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4629&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4630&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4631&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4729&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4730&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4731&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4828&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4829&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4830&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4831&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4839&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4928&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4929&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4930&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4931&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4932&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4933&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4934&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=4939&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5029&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5030&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5031&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5032&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5033&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5034&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5035&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5036&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5039&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5129&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5130&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5131&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5132&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5133&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5134&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5135&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5136&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5137&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5138&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5139&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5229&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5231&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5232&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5233&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5234&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5235&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5236&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5237&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5238&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5239&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5240&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5332&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5333&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5334&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5335&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5336&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5337&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5338&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5339&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5340&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5432&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5433&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5435&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5436&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5437&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5438&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5439&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5440&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5536&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5537&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5538&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5539&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5540&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5541&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5636&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5637&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5638&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5639&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5640&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5641&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5738&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5739&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5740&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5741&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5839&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5840&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5841&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5939&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5940&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5941&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=5942&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6039&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6040&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6041&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6139&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6140&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6141&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6239&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6240&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6241&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6243&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6339&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6340&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6341&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6342&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6343&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6439&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6440&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6441&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6442&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6443&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6444&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6445&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6540&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6541&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6542&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6543&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6544&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6545&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6641&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6642&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6643&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6644&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6645&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6741&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6742&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6840&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6841&downloadType=2
https://www.e-stat.go.jp/gis/statmap-search/data?statsId=T001102&code=6842&downloadType=2